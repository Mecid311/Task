@model List<News>
@inject TaskDbContext db;
@{
    ViewData["Title"] = "Index";
    
}


<div class="container">
    <div class="owl-carousel owl-theme">
        @foreach (var item in Model)
        {
            <div class="item"><h1><a asp-controller="home" asp-action="details" asp-route-id="@item.Id"><img class="imgggg" src="/uploads/@item.Image"></a></h1></div>
        }
    </div>
</div>
    </br>

<div class="news">
    <h1>Xəbərlər</h1>
</div>
<div class="container">
    <div class="rows sis " id="Newscat">
        @foreach (var item in Model)
        {
            <div class="card">
                <div class="card-img">
                    <img class="card-img" src="~/uploads/@item.Image" />
                    <div class="overlay">
                        <div class="overlay-content">
                            <a class="hover" asp-controller="home" asp-action="details" asp-route-id="@item.Id">Ətraflı</a>
                        </div>
                    </div>
                    <div class="card-when">
                        <div class="card-date">
                            <div class="date-day">@item.CreatedDate.ToString("dd")&nbsp;</div>
                            <div class="date-month">@item.CreatedDate.ToString("MMM")</div>
                            <div class="date-year">@item.CreatedDate.ToString("yyyy")</div>
                        </div>
                        <div class="card-time">@item.CreatedDate.ToString("HH:mm")</div>
                    </div>
                </div>

                <div class="card-content">
                    <a asp-controller="home" asp-action="details" asp-route-id="@item.Id">
                        <h2>
                            @if (item.Title.Length > 100)
                            {
                                @Html.Raw($"{item.Title.Substring(0, 100)}...")

                            }
                            else
                            {
                                @Html.Raw(item.Title)
                            }
                        </h2>
                    </a>
                </div>
                <div class="card-stats">
                    <div class="card-like card-container card-like card-selected" data-id="@item.Id">
                        <i class="fas fa-thumbs-up"></i>
                        <samp class="likeCount">@item.Likes.Count()</samp>
                    </div>
                    <div class="card-dislike card-container card-like card-selected" data-id="@item.Id">
                        <i class="fas fa-thumbs-down"></i>
                        <samp class="dislikeCount">@item.DisLikes.Count()</samp>
                    </div>
                    <div class="card-views card-container">
                        <samp class="likeCount"><i class="fas fa-eye"></i>9</samp>
                    </div>
                </div>



            </div>
        }


    </div>
</div>

@section scripts{

    <script>
        $('.card-like').click(function (e) {

            let _newsId = $(e.currentTarget).data('id');

           let formData = new FormData();

           formData.set('NewsId', _newsId);


           $.ajax({
            url: `@Url.Action("Like")`,
               type: 'POST',
               data: formData,
               processData: false,
                contentType: false,
                success: function (response) {
                    if (response.error == true) {
            toastr.error(response.message, "Xəta");
                    }
                    else {
            $(e.currentTarget).find('.likeCount').html(response.likeCount);
                    }
                },
                error: function (response) {
            console.log(response);
                    toastr.error("Bilinmeyen xeta ashkarlandi", "Xəta");
                }
            });

       });
    </script>

    <script>
        $('.card-dislike').click(function (e) {

            let _newsId = $(e.currentTarget).data('id');

           let formData = new FormData();

           formData.set('NewsId', _newsId);


           $.ajax({
            url: `@Url.Action("DisLike")`,
               type: 'POST',
               data: formData,
               processData: false,
                contentType: false,
                success: function (response) {
                    if (response.error == true) {
            toastr.error(response.message, "Xəta");
                    }
                    else {
            $(e.currentTarget).find('.dislikeCount').html(response.dislikeCount);
                    }
                },
                error: function (response) {
            console.log(response);
                    toastr.error("Bilinmeyen xeta ashkarlandi", "Xəta");
                }
            });

        });





$(document).ready(function () {
    $(".catsearch").click(function () {
        var req_data = {
            catid: $(this).val()
        };


        //console.log(this.attr("data-id"));

        $.ajax({
            url: "/Home/Getnews",
            type: "get",
            dataType: "json",
            data: req_data,
            success: function (response) {
                console.log(response)

                $("#Newscat").empty();


                $.each(response, function (key, value) {

                    console.log(value.createdDate)

                    var News = `  <div class="card">
                <div class="card-img">
                    <img class="card-img" src="/uploads/${value.image}" />
                    <div class="overlay">
                        <div class="overlay-content">
                            <a class="hover" href="/home/details/${value.id}">Ətraflı</a>
                        </div>
                    </div>

                </div>
                <div class="card-content">
                    <a href="/home/details/${value.id}">
                        <h2 class="dep_subs">
                            ${value.title}
                        </h2>
                    </a>
                </div>
              <div class="card-stats">
                    <div class="card-like card-container card-like card-selected" data-id=${value.id}>
                        <i class="fas fa-thumbs-up"></i>
                        <samp class="likeCount">${value.like}</samp>
                    </div>
                    <div class="card-dislike card-container card-like card-selected" data-id=${value.id}>
                        <i class="fas fa-thumbs-down"></i>
                        <samp class="dislikeCount">${value.dislike}</samp>
                    </div>
                    <div class="card-views card-container">
                        <samp class="likeCount"><i class="fas fa-eye"></i>9</samp>
                    </div>
                </div>
            </div>`;
                    $("#Newscat").append(News);
                });


            },
            error: function (err) {
                console.log(err);
            }

        });
    });


});

        $("#searchby").keyup(function () {
            var req_data = {
                text: $(this).val()
            };
            //console.log(this.attr("data-id"));

            $.ajax({
                url: "/Home/Search",
                type: "get",
                dataType: "json",
                data: req_data,
                success: function (response) {
                    console.log(response)

                    $("#Newscat").empty();



                    $.each(response, function (key, value) {
                        console.log(value.name);
                        var News = `  <div class="card">
                <div class="card-img">
                    <img class="card-img" src="/uploads/${value.image}" />
                    <div class="overlay">
                        <div class="overlay-content">
                            <a class="hover" href="/home/details/${value.id}">Ətraflı</a>
                        </div>
                    </div>

                </div>
                <div class="card-content">
                    <a href="/home/details/${value.id}">
                        <h2 class="dep_subs">
                            ${value.title}
                        </h2>
                    </a>
                </div>
              <div class="card-stats">
                    <div class="card-like card-container card-like card-selected" data-id=${value.id}>
                        <i class="fas fa-thumbs-up"></i>
                        <samp class="likeCount">${value.like}</samp>
                    </div>
                    <div class="card-dislike card-container card-like card-selected" data-id=${value.id}>
                        <i class="fas fa-thumbs-down"></i>
                        <samp class="dislikeCount">${value.dislike}</samp>
                    </div>
                    <div class="card-views card-container">
                        <samp class="likeCount"><i class="fas fa-eye"></i>9</samp>
                    </div>
                </div>
            </div>`;
                    
             $("#Newscat").append(News);
                    });


                },
                error: function (err) {
                    console.log(err);
                }

            });
        });


    </script>



}

@section cat{
    <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="navbarScrollingDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            Kateqoriyalar
        </a>

        <ul class="dropdown-menu" aria-labelledby="navbarScrollingDropdown">
            <li style="cursor:pointer;" asp-controller="" class="dropdown-item catsearch">
                <a class="nav-link active" asp-controller="home" asp-action="index">Baş Səhifə</a>
            </li>
            @foreach (var item in db.Categories)
            {
                <li style="cursor:pointer; margin-left:9px;" class="dropdown-item catsearch" value="@item.Id" asp-route-id="@item.Id">@item.Name</li>
            }


        </ul>
    </li>
    
}

@section search{ 
    <form class="d-flex">
        <input class="form-control me-2" type="search" id="searchby" placeholder="Search" aria-label="Search">
        
    </form>
}